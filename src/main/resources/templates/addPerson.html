<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="css/style.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="js/jquery-1.8.1.min.js"></script>
<script type="text/javascript" src="js/jquery.validate.min.js"></script>
<script type="text/javascript" src="js/additional-methods.min.js"></script>
<script src="js/uploadPreview.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function(){
	
	$("#form-info-type-person").click(function(){
		location.href="<%=path%>/goToAddPerson.action";
	});
			
	$("#form-info-type-company").click(function(){
		location.href="<%=path%>/goToAddCompany.action";
	});
		
	$("#form-info-type-admin").click(function(){
		location.href="<%=path%>/goToAddAdmin.action";
	}); 
	
	$.validator.addMethod("checkUsername", function(value, element) {
		var pattern = new RegExp("[`~!@%#$^&*()=|{}':;',　\\[\\]<>/? \\.；：%……+￥（）【】‘”“'。，、？]");  
        return !pattern.test(value);
    });
	
	$.validator.addMethod("checkId", function(value, element) {
		return isIdCardNo(value);
    });
	
	$.validator.addMethod("isMobile", function(value, element) {
	    var mobile = /^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9})$/;
	    return mobile.test(value);
	});
	
	function isIdCardNo(num) {
	    var factorArr = new Array(7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2, 1);
	    var parityBit = new Array("1", "0", "X", "9", "8", "7", "6", "5", "4", "3", "2");
	    var varArray = new Array();
	    var intValue;
	    var lngProduct = 0;
	    var intCheckDigit;
	    var intStrLen = num.length;
	    var idNumber = num;
	    // initialize
	    if ((intStrLen != 15) && (intStrLen != 18)) {
	        return false;
	    }
	    // check and set value
	    for (i = 0; i < intStrLen; i++) {
	        varArray[i] = idNumber.charAt(i);
	        if ((varArray[i] < '0' || varArray[i] > '9') && (i != 17)) {
	            return false;
	        } else if (i < 17) {
	            varArray[i] = varArray[i] * factorArr[i];
	        }
	    }

	    if (intStrLen == 18) {
	        //check date
	        var date8 = idNumber.substring(6, 14);
	        if (isDate8(date8) == false) {
	            return false;
	        }
	        // calculate the sum of the products
	        for (i = 0; i < 17; i++) {
	            lngProduct = lngProduct + varArray[i];
	        }
	        // calculate the check digit
	        intCheckDigit = parityBit[lngProduct % 11];
	        // check last digit
	        if (varArray[17] != intCheckDigit) {
	            return false;
	        }
	    }
	    else {        //length is 15
	        //check date
	        var date6 = idNumber.substring(6, 12);
	        if (isDate6(date6) == false) {
	            return false;
	        }
	    }
	    return true;
	}
	function isDate6(sDate) {
	    if (!/^[0-9]{6}$/.test(sDate)) {
	        return false;
	    }
	    var year, month, day;
	    year = sDate.substring(0, 4);
	    month = sDate.substring(4, 6);
	    if (year < 1700 || year > 2500) return false
	    if (month < 1 || month > 12) return false
	    return true
	}

	function isDate8(sDate) {
	    if (!/^[0-9]{8}$/.test(sDate)) {
	        return false;
	    }
	    var year, month, day;
	    year = sDate.substring(0, 4);
	    month = sDate.substring(4, 6);
	    day = sDate.substring(6, 8);
	    var iaMonthDays = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]
	    if (year < 1700 || year > 2500) return false
	    if (((year % 4 == 0) && (year % 100 != 0)) || (year % 400 == 0)) iaMonthDays[1] = 29;
	    if (month < 1 || month > 12) return false
	    if (day < 1 || day > iaMonthDays[month - 1]) return false
	    return true
	}
	
	$.validator.addMethod("checkEmail", function(value, element) {
        return  /^[0-9A-Za-z_]+@([0-9A-Za-z]+\.)+[a-zA-Z]{1,3}$/.test(value);
    });
	
	$("#form-info").validate({
        rules:{
        	"user.loginName" :{
        		required:true,
        		checkUsername:true,
        		remote:{
                	type:"POST",
                	url:"user_checkLoginNameJSON.action",
                	data:{
                		userName:function(){return document.getElementById("user.loginName").value;}
                    } 
                }
        	},
        	"user.email" :{
        		required:true,
        		checkEmail:true,
        		remote:{
                	type:"POST",
                	url:"user_checkEmailJSON.action",
                	data:{
                		email:function(){return document.getElementById("user.email").value;}
                    } 
                }
        	},
        	"user.userName" : {
                required:true,
                checkUsername:true
            },
            "user.identification" :{
            	required:true,
            	checkId:true,
            	maxlength: 18,
            	minlength: 15
            },
            "idImg1" :{
            	required:true,
            	accept:"gif,jpeg,jpg,bmp,png"
            },
            "idImg2" :{
            	required:true,
            	accept:"gif,jpeg,jpg,bmp,png"
            },
            "user.mobile" :{
            	required:true,
            	number:true,
            	maxlength: 11,
            	minlength: 11,
            	isMobile:true
            },
            "user.telephone" :{
            	required:false,
            	number:true,
            	maxlength: 12,
            	minlength: 11
            }
        },
        messages:{
        	"user.loginName" :{
        		required:"请输入用户名",
        		checkUsername:"真实姓名只能包括中文字、英文字母、数字和下划线",
        		remote:"该用户名已被注册"
        	},
        	"user.email" :{
        		required:"请输入邮箱",
        		checkEmail:"请输入正确的邮箱地址",
        		remote:"该邮箱地址已被注册"
        	},
        	"user.userName" : {
                required:"请输入姓名",
                checkUsername:"姓名只能包括中文字、英文字母、数字和下划线"
            },
            "user.identification" :{
            	required:"请输入您的身份证号码",
            	checkId:"身份证号码格式错误",
            	maxlength: "身份证号码最为15或18位",
            	minlength: "身份证号码最为15或18位"
            },
			"idImg1" :{
				required:"请上传您的身份证照片",
				accept:"选择文件错误,图片类型必须是(gif,jpeg,jpg,bmp,png)中的一种"
            },
            "idImg2" :{
				required:"请上传您的身份证照片",
				accept:"选择文件错误,图片类型必须是(gif,jpeg,jpg,bmp,png)中的一种"
            },
            "user.mobile" :{
            	required:"请输入手机号码",
            	number:"手机号码为数字",
            	maxlength: "手机号码为11位数字",
            	minlength: "手机号码为11位数字",
            	isMobile:"手机号码格式错误"
            },
            "user.telephone" :{
            	number:"固定电话为数字",
            	maxlength: "固定电话长度超过12位数字",
                minlength: "固定电话最小长度为11位数字"
            }
        }
    });
	$("#submitBtn").click(function(){
		var val=document.getElementById("user.telephone").value;
	    if(val=="" || val==null){
	        return true;
	    }else{
	    	
	    	var reg = new RegExp("^[0-9]*$");
	    	if(reg.test(val) && val.length<13 && val.length>10){
	            return true;
	        }else{
	        	return false;
	        }
	    }
	});
	
});
window.onload = function () {
	new uploadPreview({UpBtn: "idImg1", DivShow: "imgdiv1", ImgShow: "imgShow1"});
	new uploadPreview({UpBtn: "idImg2", DivShow: "imgdiv2", ImgShow: "imgShow2"});
}
</script>
</head>
<body>
<div class="content">
    <div class="main_panel">
        <h3 class="crumbs">
            <img src="../images/sidebar_h3_bg1.gif" alt=""/> 当前位置：<a href="#">首页&nbsp;&nbsp;&nbsp;></a><a href="#" style="margin-left:-10px">用户管理</a>
        </h3>
        <div class="main_content">
                <div class="form-box">
                    <form action="addUser.action" id="form-info" name="form-info" method="post" enctype="multipart/form-data">
                    <table class="up_table"  cellpadding="0" cellspacing="0">
                        <tbody>
                        	<tr>
                            	<td align="right" width="40%"><label>开发者类型:</label></td>
                            	<td align="left" width="60%">
                            	<label><input id="form-info-type-admin" type="radio" value="0"
								name="user.role"/>管理员</label>
                            	<label><input id="form-info-type-person" type="radio" value="1"
								checked="checked" name="user.role"/>个人</label>
								<label><input id="form-info-type-company" type="radio" value="2"
								name="user.role"/>公司</label>
								</td>
                        	</tr>
                        	<tr>
                            	<td align="right" width="40%"><label>用&nbsp;&nbsp;户&nbsp;&nbsp;名:</label></td>
                            	<td align="left" width="60%"><label><input type="text" class="text" name="user.loginName" 
                            	id="user.loginName" maxlength="20"
								placeholder="请输入您的用户名" /><b>*</b></label></td>
                        	</tr>
                        	<tr>
                            	<td align="right"><label>邮&nbsp;&nbsp;&nbsp;&nbsp;箱:</label></td>
                            	<td align="left"><label>
                            	<input type="text" class="text" name="user.email" 
                            	id="user.email" maxlength="250"
								placeholder="请输入您的用户名" /><b>*</b></label></td>
                        	</tr>
                        	<tr>
                            	<td align="right"><label>姓&nbsp;&nbsp;&nbsp;&nbsp;名:</label></td>
                            	<td align="left"><label><input type="text" class="text" id="user.userName" 
                            	name="user.userName"
								placeholder="请输入您的姓名" /><b>*</b></label></td>
                            </tr>
                            <tr>
								<td align="right">身份证号码:</td>
								<td align="left"><label><input type="text" class="text" id="user.identification" name="user.identification"
								maxlength="18" placeholder="请输入您的身份证号码" /><b>*</b></label></td>
							</tr>
							<tr>
								<td align="right">身份证照正面:</td>
								<td align="left">
									<div id="imgdiv1">
										<label>
										<img class="imghead" id="imgShow1" width="257" height="162"
										src="images/upload.png"  /><b>(身份证照片规格:270x428)*</b>
										</label>
									</div>
								 	<input type="file" name="idImg1" class="uploadImg" id="idImg1"/>
								</td>
							</tr>
							<tr>
								<td align="right">身份证照反面:</td>
								<td align="left">
									<div id="imgdiv2">
										<label>
										<img class="imghead" id="imgShow2" width="257" height="162"
										src="images/upload.png"  /><b>(身份证照片规格:270x428)*</b>
										</label>
									</div>
								 	<input type="file" name="idImg2" class="uploadImg" id="idImg2"/>
								</td>
							</tr>
                       		<tr>
                            	<td align="right"><label>手&nbsp;&nbsp;&nbsp;&nbsp;机:</label></td>
                            	<td align="left"><label><input type="text" class="text" name="user.mobile" 
                            	id="user.mobile" maxlength="11"
								placeholder="请输入您的手机号码" /><b>*</b></label></td>
                        	</tr>
                        	<tr>
                            	<td align="right"><label>电&nbsp;&nbsp;&nbsp;&nbsp;话:</label></td>
                            	<td align="left"><label><input type="text" class="text" name="user.telephone" 
                            	id="user.telephone" maxlength="12"
								placeholder="请输入您的电话" /><b>*</b></label></td>
                        	</tr>
                        </tbody>
                    </table>
                    <div style=" text-align:center; margin-top:10px;">
                    	<input type="submit" id="submitBtn"  value="保存" class="btn5"/> 
                    </div>
                    </form>
                </div>
        </div>
    </div>
</div>
</body>
</html>

